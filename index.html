<!DOCTYPE html>
<html>
<head>
  <title>EcoFinds â€“ Product Listings</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>EcoFinds Marketplace</h2>

  <!-- Search & Filter -->
  <input type="text" id="searchInput" placeholder="Search by title">
  <select id="categoryFilter">
    <option value="">All Categories</option>
    <option value="Electronics">Electronics</option>
    <option value="Books">Books</option>
    <option value="Clothing">Clothing</option>
    <option value="Furniture">Furniture</option>
    <option value="Others">Others</option>
  </select>
  <button onclick="loadProducts()">Apply</button>
  <br><br>

  <div id="list"></div>

  <br>
  <a href="add-product.html">âž• Add New Product</a> |
  <a href="my-listings.html">ðŸ“‚ My Listings</a> |
  <a href="login.html">Logout</a>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="firebase.js"></script>

  <script>
    function loadProducts() {
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      const categoryValue = document.getElementById("categoryFilter").value;

      db.collection("products").orderBy("createdAt", "desc").get().then(snapshot => {
        const list = document.getElementById("list");
        list.innerHTML = "";

        snapshot.forEach(doc => {
          const p = doc.data();
          const titleMatch = p.title.toLowerCase().includes(searchValue);
          const categoryMatch = !categoryValue || p.category === categoryValue;

          if (titleMatch && categoryMatch) {
            list.innerHTML += `
              <div style="border:1px solid #ccc; padding:10px; margin:10px;">
                ${p.image ? `<img src="${p.image}" width="100"><br>` : ""}
                <strong>${p.title}</strong><br>
                â‚¹${p.price}<br>
                Category: ${p.category}<br>
                <a href="product.html?id=${doc.id}">View Details</a>
              </div>
            `;
          }
        });
      });
    }

    // Load products on page load
    window.onload = loadProducts;
  </script>
</body>
</html>
